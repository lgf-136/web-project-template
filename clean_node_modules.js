
const fs = require('fs');

const delTargetDir = 'node_modules';

const enterTargetDir = '.';

function deleteFolder(path) {
  let files = [];
  if (fs.existsSync(path)) {
    files = fs.readdirSync(path);
    files.forEach(file => {
      const curPath = `${path}/${file}`;
      //  本来网上是statSync 我给改成了 lstatSync
      if (fs.lstatSync(curPath).isDirectory()) {
        deleteFolder(curPath);
      } else {
        fs.unlinkSync(curPath);
      }
    });
    fs.rmdirSync(path);
  }
}

function deleteTargetFolder(path, target) {
  let files = [];
  if (fs.existsSync(path)) {
    files = fs.readdirSync(path);
    files.forEach(file => {
      const curPath = `${path}/${file}`;
      if (fs.lstatSync(curPath).isDirectory()) {
        // 同下边 都改成lstatSync
        if (file === target) {
          deleteFolder(curPath);
        } else {
          deleteTargetFolder(curPath, target);
        }
      }
    });
  }
}

deleteTargetFolder(enterTargetDir, delTargetDir);
